# 测试说明文档

## 环境准备

1. 确保已安装Python 3.8+
2. 安装依赖：
```bash
pip install -r requirements.txt
```

3. 确保MongoDB服务器正在运行
4. 确保主应用服务器正在运行：
```bash
bun run dev
```

5. 初始化数据库（如果尚未初始化）：
```bash
bun run db:init
```

## 测试内容

### 1. 学习会话测试 (test_study_session.py)
- 完整学习会话流程测试
- 学习中断处理测试
- 环境监控功能测试
- 姿势监控功能测试

### 2. 自动化测试 (test_automation.py)
- 台灯自动化控制测试
- 专注模式自动化测试
- 通知自动化测试

## 运行测试

运行所有测试：
```bash
pytest -v
```

运行特定测试文件：
```bash
pytest -v test_study_session.py
pytest -v test_automation.py
```

运行特定测试用例：
```bash
pytest -v test_study_session.py::test_complete_study_session
```

## 测试场景说明

### 完整学习会话流程
1. 绑定所需设备（台灯、智能手表、手写笔）
2. 启动学习会话
3. 模拟设备数据上报（环境数据、生物数据、笔记数据）
4. 结束会话并生成学习报告
5. 验证数据完整性和准确性

### 中断处理
1. 模拟学习过程中的暂停
2. 验证数据记录的连续性
3. 测试恢复学习功能

### 环境监控
1. 模拟不良环境条件（光线不足、噪音过大等）
2. 验证自动化响应（调整台灯、发送提醒等）
3. 测试数据记录和分析

### 姿势监控
1. 模拟不良坐姿数据
2. 验证提醒机制
3. 测试数据统计和分析

### 自动化规则
1. 测试基于环境的自动化（如光线自动调节）
2. 测试基于时间的自动化（如定时启动专注模式）
3. 测试基于生物数据的自动化（如姿势提醒）

## 注意事项

1. 测试前确保所有服务正常运行
2. 测试数据会自动清理
3. WebSocket连接需要保持稳定
4. 某些测试可能需要等待几秒钟以确保异步操作完成
5. 建议在测试环境中运行，避免影响生产数据
